ğŸ¯ ARCHITECTURE & FLUX - ESIG ATELIER 2026
==========================================

## ğŸ“ ARCHITECTURE GLOBALE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ESIG ATELIER APPLICATION                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  login.html    â”‚  â”‚ MODE-VISITEUR  â”‚  â”‚  index.html   â”‚  â”‚
â”‚  â”‚ (Authentif)    â”‚â”€â”€â”‚   (Visiteur)   â”‚  â”‚  (Dashboard)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                         â–²           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              admin.html (Admin Panel)                  â”‚  â”‚
â”‚  â”‚  âœ… VÃ©rification rÃ´le: role === 'admin'               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â–²                                      â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚  Firebase   â”‚
                    â”‚  Auth/DB    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ FLUX D'AUTHENTIFICATION

```
USER ACCÃˆDE login.html
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase chargÃ©?  â”‚  âœ… SDK + config.js chargÃ©s
â”‚ window.auth OK?   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ âœ… OUI
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Utilisateur se connecte      â”‚
â”‚ email: admin@esig.tg         â”‚
â”‚ password: ****               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase Auth valide         â”‚
â”‚ token = JWT gÃ©nÃ©rÃ©           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DataManager.users.getById()  â”‚
â”‚ Charge profil depuis Firestoreâ”‚
â”‚ Collection: 'users'          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ localStorage.setItem(token)  â”‚
â”‚ currentUser = user obj       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ window.location.href =       â”‚
â”‚ 'index.html'                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
INDEX.HTML CHARGÃ‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ auth.onAuthStateChanged()    â”‚ âœ… DÃ©tecte user connectÃ©
â”‚ Charge TPs depuis 'TP'       â”‚
â”‚ Affiche Dashboard            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š STRUCTURE FIRESTORE

```
FIRESTORE PROJECT: esig-atelier-64235

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COLLECTIONS                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ ğŸ“¦ users/                       â”‚
â”‚   â””â”€ Documents:                 â”‚
â”‚      â”œâ”€ uid (Admin)             â”‚
â”‚      â”œâ”€ email, nom, prenom      â”‚
â”‚      â”œâ”€ role: 'admin'           â”‚
â”‚      â””â”€ autres users...         â”‚
â”‚                                 â”‚
â”‚ ğŸ”¬ TP/    â­ CORRIGÃ‰ (UPPERCASE)â”‚
â”‚   â””â”€ Documents:                 â”‚
â”‚      â”œâ”€ ARYX2xM1vWbaWk8DqZMo... â”‚
â”‚      â”œâ”€ SU3PCclWrFdnynzP5FZy... â”‚
â”‚      â”œâ”€ TP                      â”‚
â”‚      â”œâ”€ auecEPxgHDdViQ0KLIS...  â”‚
â”‚      â””â”€ Fields:                 â”‚
â”‚         â”œâ”€ titre                â”‚
â”‚         â”œâ”€ type                 â”‚
â”‚         â”œâ”€ creatorId            â”‚
â”‚         â”œâ”€ participants: []     â”‚
â”‚         â”œâ”€ statut               â”‚
â”‚         â”œâ”€ dateDebut            â”‚
â”‚         â””â”€ duree                â”‚
â”‚                                 â”‚
â”‚ ğŸ”§ machines/                    â”‚
â”‚   â””â”€ nom, type, statut, etc    â”‚
â”‚                                 â”‚
â”‚ ğŸ“¦ stocks/                      â”‚
â”‚   â””â”€ nom, quantite, prix, etc  â”‚
â”‚                                 â”‚
â”‚ ğŸ”¨ maintenance/                 â”‚
â”‚   â””â”€ type, date, statut, etc   â”‚
â”‚                                 â”‚
â”‚ ğŸ“ˆ activities/                  â”‚
â”‚   â””â”€ action, user, timestamp   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ MODULES JAVASCRIPT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           app/js/ - MODULES CRITIQUES                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1ï¸âƒ£ config.js (PRINCIPAL - 680 lignes)                      â”‚
â”‚     â”œâ”€ FIREBASE_CONFIG: vraies clÃ©s                          â”‚
â”‚     â”œâ”€ APP_CONFIG: paramÃ¨tres app                            â”‚
â”‚     â”œâ”€ COLLECTIONS: noms des collections                     â”‚
â”‚     â”‚   â””â”€ TP: 'TP' âœ… CORRIGÃ‰                              â”‚
â”‚     â”œâ”€ DataManager:                                          â”‚
â”‚     â”‚   â”œâ”€ users.CRUD                                        â”‚
â”‚     â”‚   â”œâ”€ tp.CRUD            âœ… Utilise 'TP'              â”‚
â”‚     â”‚   â”œâ”€ machines.CRUD                                     â”‚
â”‚     â”‚   â”œâ”€ stocks.CRUD                                       â”‚
â”‚     â”‚   â””â”€ maintenance.CRUD                                  â”‚
â”‚     â””â”€ RealtimeListener: for real-time updates              â”‚
â”‚                                                               â”‚
â”‚  2ï¸âƒ£ firebase-init.js (INITIALISATION)                       â”‚
â”‚     â”œâ”€ getAuth()                                             â”‚
â”‚     â”œâ”€ getFirestore()                                        â”‚
â”‚     â””â”€ initializeFirebase()                                  â”‚
â”‚                                                               â”‚
â”‚  3ï¸âƒ£ auth.js (AUTHENTIFICATION)                              â”‚
â”‚     â”œâ”€ AuthManager.login(email, password)                    â”‚
â”‚     â”œâ”€ AuthManager.register(...)                             â”‚
â”‚     â”œâ”€ AuthManager.logout()                                  â”‚
â”‚     â”œâ”€ AuthManager.loadUserData(uid)                         â”‚
â”‚     â””â”€ AuthManager.resetPassword(email)                      â”‚
â”‚                                                               â”‚
â”‚  4ï¸âƒ£ database.js (LEGACY - peut Ãªtre supprimÃ©)               â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ FLUX REQUÃŠTES

### 1ï¸âƒ£ CREATE TP (CrÃ©er un TP)
```
User submits form
         â”‚
         â–¼
DataManager.tp.create({
  titre, type, creatorId, participants, ...
})
         â”‚
         â–¼
db.collection('TP').add(document)  â† Collection: 'TP' âœ…
         â”‚
         â–¼
Firestore valide permissions
         â”‚
         â–¼
Document crÃ©Ã© avec ID auto-gÃ©nÃ©rÃ©
```

### 2ï¸âƒ£ READ TPs (Charger les TPs)
```
Page charge (index.html ou admin.html)
         â”‚
         â–¼
DataManager.tp.getAll()
         â”‚
         â–¼
db.collection('TP')        â† Collection: 'TP' âœ…
  .orderBy('dateCreation')
  .get()
         â”‚
         â–¼
Retourne snapshot avec 4 documents
         â”‚
         â–¼
Affiche dans tableau/liste
```

### 3ï¸âƒ£ UPDATE TP (Modifier un TP)
```
Admin clique "Modifier"
         â”‚
         â–¼
DataManager.tp.update(tpId, {nouveaux donnÃ©es})
         â”‚
         â–¼
db.collection('TP')     â† Collection: 'TP' âœ…
  .doc(tpId)
  .update({...})
         â”‚
         â–¼
Document mis Ã  jour
```

### 4ï¸âƒ£ DELETE TP (Supprimer un TP)
```
Admin clique "Supprimer"
         â”‚
         â–¼
DataManager.tp.delete(tpId)
         â”‚
         â–¼
db.collection('TP')     â† Collection: 'TP' âœ…
  .doc(tpId)
  .delete()
         â”‚
         â–¼
Document supprimÃ©
```

---

## âœ… CHECKLIST VÃ‰RIFICATION

```
FIREBASE INITIALIZATION
  âœ… SDK chargÃ© dans HTML
  âœ… firebase.initializeApp() appelÃ©
  âœ… FIREBASE_CONFIG avec vraies clÃ©s
  âœ… window.auth crÃ©Ã© globalement
  âœ… window.db crÃ©Ã© globalement
  âœ… Persistance activÃ©e

AUTHENTIFICATION
  âœ… Email/password fonctionnel
  âœ… Registration nouveau user possible
  âœ… logout() fonctionne
  âœ… Password reset implÃ©mentÃ©
  âœ… Redirection si pas authentifiÃ©

COLLECTIONS FIRESTORE
  âœ… users collection accessible
  âœ… TP collection accessible (UPPERCASE)  â† CORRIGÃ‰
  âœ… machines collection accessible
  âœ… stocks collection accessible
  âœ… maintenance collection accessible

DATA LOADING
  âœ… DataManager.users.getAll() fonctionne
  âœ… DataManager.tp.getAll() fonctionne (utilise 'TP')
  âœ… DataManager.machines.getAll() fonctionne
  âœ… DataManager.stocks.getAll() fonctionne

PAGES
  âœ… login.html: Authentification
  âœ… index.html: Dashboard utilisateur
  âœ… admin.html: Admin panel (avec vÃ©rification rÃ´le)
  âœ… MODE-VISITEUR.html: Mode lecture

PERMISSIONS
  âœ… User peut crÃ©er TP
  âœ… Admin peut voir tous les TPs
  âœ… Admin peut supprimer TP
  âœ… Visiteur peut lire (mode dÃ©mo)
```

---

## ğŸ› DIAGNOSTIC RAPIDE

### Si TP ne s'affiche pas:
```
1. Ouvrir Console (F12) â†’ Console
2. Taper: DataManager.tp.getAll()
3. Attendre la promesse
4. VÃ©rifier les rÃ©sultats
```

### Si erreur authentification:
```
1. VÃ©rifier: console.log(window.auth)
2. VÃ©rifier: console.log(firebase.auth().currentUser)
3. VÃ©rifier: localStorage pour token
```

### Si erreur Firestore:
```
1. Ouvrir: verify-tp-fix.html
2. Cliquer: "1. Tester Connexion Firebase"
3. Cliquer: "3. Charger Tous les TPs"
4. VÃ©rifier les logs
```

---

## ğŸ“ˆ PERFORMANCE

```
Metrics attendus:
- Page load: < 2 secondes
- Auth check: < 500ms
- TP load: < 1 seconde (4 documents)
- Admin page: < 2 secondes (tous les data)

Optimisations en place:
âœ… Firestore persistence (offline support)
âœ… Lazy loading des images
âœ… CSS minifiÃ©
âœ… Firebase indexing pour queries
```

---

## ğŸ” SÃ‰CURITÃ‰

```
Firestore Rules:
- âœ… Authentification requise pour accÃ¨s
- âœ… RÃ´les vÃ©rifiÃ©s pour admin
- âœ… Utilisateurs ne peuvent accÃ©der qu'Ã  leurs donnÃ©es
- âš ï¸ Ã€ renforcer: granular permissions par collection

Firebase Auth:
- âœ… Email/password avec validation
- âœ… Token JWT auto-gÃ©nÃ©rÃ©
- âœ… HTTPS automatique
- âœ… Rate limiting Firebase

Ã€ faire:
- [ ] Ajouter MFA (multi-factor auth)
- [ ] Activer CORS restrictif
- [ ] Rate limiting custom pour API
- [ ] Audit logging amÃ©liorÃ©
```

---

## ğŸ“… TIMELINE CORRECTIF

| Date | Action | Fichiers |
|------|--------|----------|
| Jan 19 | IdentifiÃ©: Collection='tp' au lieu de 'TP' | audit |
| Jan 19 | CorrigÃ©: config.js, firebase-config.js | 2 fichiers |
| Jan 19 | CorrigÃ©: test-tp.html, list-all-tps.html | 2 fichiers |
| Jan 19 | CrÃ©Ã©: verify-tp-fix.html pour tester | 1 fichier |
| Jan 19 | Documentation complÃ¨te | AUDIT-COMPLET-2026.md |

**Status: CORRIGÃ‰ âœ…**

---

## ğŸ¯ Ã‰TAT FINAL

Le projet ESIG Atelier est **PRÃŠT Ã€ TESTER**

âœ… Tous les composants en place
âœ… Collection 'TP' (uppercase) corrigÃ©e
âœ… 4 TPs accessibles
âœ… Authentification fonctionnelle
âœ… Admin panel opÃ©rationnel
âœ… Mode visiteur disponible

**Prochaine Ã©tape: Tester le flux complet login â†’ dashboard â†’ crÃ©er TP**
